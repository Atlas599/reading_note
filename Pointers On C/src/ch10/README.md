# 第十章：结构和联合

结构体很重要，在后续的链表、二叉树，`OJ` 题目的数据存储等都广泛应用到。

## 本章总结及注意点

![1](https://raw.githubusercontent.com/Y-puyu/picture/main/images/20201225144726.png)

![2](https://raw.githubusercontent.com/Y-puyu/picture/main/images/20201225145140.png)

![3](https://raw.githubusercontent.com/Y-puyu/picture/main/images/20201225145244.png)

---

## 部分课后习题解答

### 10.10 问题

1. 成员可以是不同类型，其按名称来访问，并非连续存储，有边界要求。而数组元素必须是同一类型，按下标访问，连续存储，边界对其元素。

2. 结构名为一个标量，作右值时，表示存储在结构中的值，作左值时，表示结构存储的内存位置。数组名为一个常量指针，其仅能作右值表示指向数组第一个元素的指针，不可以作左值。

3. 以往写的大多都是 `typedef` 多一点。见参考答案：

    ![4](https://raw.githubusercontent.com/Y-puyu/picture/main/images/20201225150617.png)

4. `abc` 是结构标记，而不是变量的名称。赋值语句非法。

5. `abc` 是类型名，而不是变量名。赋值语句是非法的。

6. `x = { 3, "hello" };`，`c` 的值可有可无，`x` 存储与静态内存中。

7. 首先这个结构体大小为 12 字节。很不错的一道题啊！！！

   `nodes[3].c` 是**该结构体数组的起始地址**，是 200。

    `*nodes` 是`首元素`，即第一个结构。

    `npp` 是真滴秀...直接就是 216。200+4*4 = 216。

    ![5](https://raw.githubusercontent.com/Y-puyu/picture/main/images/20201225151938.png)

8. 2个、6个。

9. 不确定字段是从右向左还是从左向右分配。字段与整形位数相关。如果字段太大，无法存储，不确定其是否会侵占下一个字段或者下一个字。

10. 两种均正确，取决于编译器分配字段的方式。见参考答案：

    ![6](https://raw.githubusercontent.com/Y-puyu/picture/main/images/20201225152523.png)

11. 保证字段不溢出是很不错的操作！基本和书前所讲一致。见参考答案：

    ![7](https://raw.githubusercontent.com/Y-puyu/picture/main/images/20201225152659.png)

12. 2 或者 -2，取决于编译器。

13. 联合当做结构用，前两个值为垃圾，最后一个打印正确。

14. 啥意思，题目说的。参考答案：用于存储数据的同一成员也必须用于读取数据。

15. 占空间。

### 10.11 编程练习

1. 很简单的数据存储设计。见答案：

    ![8](https://raw.githubusercontent.com/Y-puyu/picture/main/images/20201225154054.png)

2. 见 `demo01.c`。读题就能发现，三种情况同时只会有一个发生，那么就需要采用**联合实现变体记录的方式来优化数据结构设计**。

3. 取决于编译器分配字段的方向。见 `demo02.c`。

### 随笔

字符串的处理在编程中都是很常见且重要的，本章也比较基础，比较容易理解，还是得多写、多用，才能踩坑，才能掌握。

### 疑问

1. `strtok()` 函数，用来查找标记。这个函数我在学习过程中没遇见过，起初看书的时候感觉很难理解。找标记是很简单的事情，拿集合中的字符进行匹配即可，但是，它找到标记之后会将该标记位置置成 `NUL`？这还直接修改原字符串了...并且它的第一个参数还能是 `NULL`？结果最后讲的是它能保存它所处理的函数的局部状态信息，所以不能同时用它来解析两个字符串。那么是不是可以推断得到，其不能出现在同一个代码块中，不能嵌套使用，该 `strtok()` 函数的作用域中，不能再给其另一个字符串了？我猜应该是这个样子的。

2. 手撕 `memcpy()` 函数是非常重要的，秋招面试的时候，都不知道被考了多少回了...注意 `memmove()` 函数处理内存重叠时的方式。

3. `strncat()` 函数不会检查 `dst` 剩余空间是否足够，就直接从 `src` 中向后拼接 `len` 个再加上一个 `NUL` 字符到 `dst` 后面。故很有可能会造成数组越界，将后面的位置空间给侵占成拼接字符串了。
